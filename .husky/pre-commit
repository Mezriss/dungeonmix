echo "Prettifying..."
./node_modules/.bin/prettier $(git diff --cached --name-only --diff-filter=ACMR | sed 's| |\\ |g') --write --ignore-unknown
git update-index --again

echo "Typechecking..."
./node_modules/.bin/tsc -b --noEmit

echo "Linting..."
./node_modules/.bin/eslint .

echo "Running tests..."
FILES=$(git diff --cached --name-only --diff-filter=ACM | tr '\n' ' ')
if [ -n "$FILES" ]; then
  pnpm vitest related $FILES --run
fi

echo "All checks passed."
